<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Authenticity Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .metric-card {
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-healthy { background-color: #10b981; }
        .status-warning { background-color: #f59e0b; }
        .status-critical { background-color: #ef4444; }
        
        .risk-low { background-color: #dcfce7; color: #166534; }
        .risk-medium { background-color: #fef3c7; color: #92400e; }
        .risk-high { background-color: #fee2e2; color: #991b1b; }
        .risk-critical { background-color: #fde2e8; color: #831843; }
        
        .platform-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .real-time-feed {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .alert-item {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <i class="fas fa-shield-check text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-gray-900">Content Authenticity Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <span class="status-indicator status-healthy" id="api-status"></span>
                        <span class="text-sm text-gray-600" id="api-status-text">API Connected</span>
                    </div>
                    <button id="refresh-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        <i class="fas fa-sync mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Analyses -->
            <div class="metric-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-md">
                        <i class="fas fa-chart-bar text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Total Analyses</p>
                        <p class="text-2xl font-semibold text-gray-900" id="total-analyses">-</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-sm text-green-600" id="total-change">+12% from yesterday</span>
                </div>
            </div>

            <!-- Risk Detection Rate -->
            <div class="metric-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-red-100 rounded-md">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Risk Detection Rate</p>
                        <p class="text-2xl font-semibold text-gray-900" id="risk-rate">-</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-sm text-gray-600" id="risk-change">-2% from yesterday</span>
                </div>
            </div>

            <!-- Avg Response Time -->
            <div class="metric-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-md">
                        <i class="fas fa-clock text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Avg Response Time</p>
                        <p class="text-2xl font-semibold text-gray-900" id="avg-response-time">-</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-sm text-green-600" id="response-change">-15ms from yesterday</span>
                </div>
            </div>

            <!-- Active Integrations -->
            <div class="metric-card bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-md">
                        <i class="fas fa-plug text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Active Integrations</p>
                        <p class="text-2xl font-semibold text-gray-900" id="active-integrations">-</p>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-sm text-gray-600" id="integrations-status">All systems operational</span>
                </div>
            </div>
        </div>

        <!-- Charts and Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Analysis Trends -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Analysis Trends (Last 24 Hours)</h2>
                <canvas id="trends-chart" height="300"></canvas>
            </div>

            <!-- Risk Distribution -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Risk Level Distribution</h2>
                <canvas id="risk-distribution-chart" height="300"></canvas>
            </div>
        </div>

        <!-- Platform Breakdown and Real-time Feed -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Platform Performance -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Platform Performance</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200" id="platform-table">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Platform</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Analyses</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Rate</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Avg Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="platform-table-body">
                            <!-- Platform rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Real-time Activity Feed -->
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Real-time Activity</h2>
                    <div class="flex items-center">
                        <div class="status-indicator status-healthy"></div>
                        <span class="text-sm text-gray-600">Live</span>
                    </div>
                </div>
                <div class="real-time-feed" id="activity-feed">
                    <!-- Activity items will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Alerts and Notifications -->
        <div class="mt-8 bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Recent Alerts</h2>
            <div id="alerts-container">
                <!-- Alerts will be inserted here -->
            </div>
        </div>
    </main>

    <!-- Configuration Modal -->
    <div id="config-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Dashboard Configuration</h3>
            </div>
            <div class="px-6 py-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">API Endpoint</label>
                        <input type="url" id="api-endpoint" class="w-full border border-gray-300 rounded-md px-3 py-2" 
                               placeholder="https://api.contentauthenticity.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                        <input type="password" id="api-key" class="w-full border border-gray-300 rounded-md px-3 py-2" 
                               placeholder="Your API key">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Refresh Interval (seconds)</label>
                        <input type="number" id="refresh-interval" class="w-full border border-gray-300 rounded-md px-3 py-2" 
                               value="30" min="5" max="300">
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                <button id="cancel-config" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                    Cancel
                </button>
                <button id="save-config" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    Save
                </button>
            </div>
        </div>
    </div>

    <script>
        class ContentAuthenticityDashboard {
            constructor() {
                this.apiEndpoint = localStorage.getItem('ca_api_endpoint') || 'https://api.contentauthenticity.com';
                this.apiKey = localStorage.getItem('ca_api_key') || '';
                this.refreshInterval = parseInt(localStorage.getItem('ca_refresh_interval') || '30');
                this.charts = {};
                this.websocket = null;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.initCharts();
                this.loadDashboardData();
                this.startRealTimeUpdates();
                this.connectWebSocket();
                
                // Show config modal if not configured
                if (!this.apiKey) {
                    this.showConfigModal();
                }
            }
            
            setupEventListeners() {
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadDashboardData();
                });
                
                document.getElementById('save-config').addEventListener('click', () => {
                    this.saveConfiguration();
                });
                
                document.getElementById('cancel-config').addEventListener('click', () => {
                    this.hideConfigModal();
                });
                
                // Settings gear icon (if you add one)
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'F2') {
                        this.showConfigModal();
                    }
                });
            }
            
            async loadDashboardData() {
                try {
                    this.showLoading();
                    
                    // Load analytics summary
                    const analyticsData = await this.fetchAnalyticsSummary();
                    this.updateMetrics(analyticsData);
                    this.updateCharts(analyticsData);
                    this.updatePlatformTable(analyticsData.platforms);
                    
                    // Load recent alerts
                    const alertsData = await this.fetchRecentAlerts();
                    this.updateAlerts(alertsData);
                    
                    this.updateApiStatus('connected');
                    
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                    this.updateApiStatus('error');
                } finally {
                    this.hideLoading();
                }
            }
            
            async fetchAnalyticsSummary() {
                // Mock data for demonstration
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            total_analyses_today: 15742,
                            risk_detection_rate: 8.3,
                            avg_response_time: 245,
                            active_integrations: 12,
                            trends: {
                                labels: Array.from({length: 24}, (_, i) => `${23-i}h ago`),
                                analyses: Array.from({length: 24}, () => Math.floor(Math.random() * 100) + 50),
                                risks: Array.from({length: 24}, () => Math.floor(Math.random() * 20) + 5)
                            },
                            risk_distribution: {
                                low: 78,
                                medium: 15,
                                high: 5,
                                critical: 2
                            },
                            platforms: [
                                { name: 'E-commerce', icon: 'fas fa-shopping-cart', analyses: 6234, risk_rate: 6.2, avg_score: 0.82, status: 'healthy' },
                                { name: 'Social Media', icon: 'fas fa-share-alt', analyses: 4521, risk_rate: 12.4, avg_score: 0.74, status: 'warning' },
                                { name: 'App Store', icon: 'fas fa-mobile-alt', analyses: 2987, risk_rate: 4.1, avg_score: 0.89, status: 'healthy' },
                                { name: 'Review Sites', icon: 'fas fa-star', analyses: 2000, risk_rate: 9.8, avg_score: 0.76, status: 'healthy' }
                            ]
                        });
                    }, 1000);
                });
            }
            
            async fetchRecentAlerts() {
                // Mock alerts data
                return [
                    {
                        id: 1,
                        type: 'high_risk',
                        platform: 'Social Media',
                        message: 'Coordinated inauthentic behavior detected',
                        timestamp: new Date(Date.now() - 5 * 60 * 1000),
                        severity: 'high'
                    },
                    {
                        id: 2,
                        type: 'integration',
                        platform: 'E-commerce',
                        message: 'API rate limit approaching (80%)',
                        timestamp: new Date(Date.now() - 15 * 60 * 1000),
                        severity: 'medium'
                    },
                    {
                        id: 3,
                        type: 'model_update',
                        platform: 'System',
                        message: 'Model performance improved by 3.2%',
                        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),
                        severity: 'low'
                    }
                ];
            }
            
            updateMetrics(data) {
                document.getElementById('total-analyses').textContent = data.total_analyses_today.toLocaleString();
                document.getElementById('risk-rate').textContent = data.risk_detection_rate + '%';
                document.getElementById('avg-response-time').textContent = data.avg_response_time + 'ms';
                document.getElementById('active-integrations').textContent = data.active_integrations;
            }
            
            initCharts() {
                // Trends Chart
                const trendsCtx = document.getElementById('trends-chart').getContext('2d');
                this.charts.trends = new Chart(trendsCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Analyses',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'High Risk',
                            data: [],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                // Risk Distribution Chart
                const riskCtx = document.getElementById('risk-distribution-chart').getContext('2d');
                this.charts.riskDistribution = new Chart(riskCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Low Risk', 'Medium Risk', 'High Risk', 'Critical Risk'],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                'rgb(16, 185, 129)',
                                'rgb(245, 158, 11)',
                                'rgb(239, 68, 68)',
                                'rgb(131, 24, 67)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            updateCharts(data) {
                // Update trends chart
                this.charts.trends.data.labels = data.trends.labels;
                this.charts.trends.data.datasets[0].data = data.trends.analyses;
                this.charts.trends.data.datasets[1].data = data.trends.risks;
                this.charts.trends.update();
                
                // Update risk distribution chart
                this.charts.riskDistribution.data.datasets[0].data = [
                    data.risk_distribution.low,
                    data.risk_distribution.medium,
                    data.risk_distribution.high,
                    data.risk_distribution.critical
                ];
                this.charts.riskDistribution.update();
            }
            
            updatePlatformTable(platforms) {
                const tbody = document.getElementById('platform-table-body');
                tbody.innerHTML = '';
                
                platforms.forEach(platform => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="${platform.icon} platform-icon text-gray-600"></i>
                                <span class="text-sm font-medium text-gray-900">${platform.name}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${platform.analyses.toLocaleString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${platform.risk_rate}%
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${(platform.avg_score * 100).toFixed(1)}%
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="status-indicator status-${platform.status}"></span>
                            <span class="text-sm text-gray-600 capitalize">${platform.status}</span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            updateAlerts(alerts) {
                const container = document.getElementById('alerts-container');
                container.innerHTML = '';
                
                if (alerts.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">No recent alerts</p>';
                    return;
                }
                
                alerts.forEach(alert => {
                    const alertElement = document.createElement('div');
                    alertElement.className = `alert-item flex items-center justify-between p-4 mb-3 rounded-lg border-l-4 ${
                        alert.severity === 'high' ? 'bg-red-50 border-red-400' :
                        alert.severity === 'medium' ? 'bg-yellow-50 border-yellow-400' :
                        'bg-blue-50 border-blue-400'
                    }`;
                    
                    alertElement.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas ${
                                alert.severity === 'high' ? 'fa-exclamation-triangle text-red-600' :
                                alert.severity === 'medium' ? 'fa-exclamation-circle text-yellow-600' :
                                'fa-info-circle text-blue-600'
                            } mr-3"></i>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${alert.message}</p>
                                <p class="text-xs text-gray-600">${alert.platform} • ${this.formatTime(alert.timestamp)}</p>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    container.appendChild(alertElement);
                });
            }
            
            connectWebSocket() {
                if (!this.apiKey) return;
                
                try {
                    const wsUrl = this.apiEndpoint.replace('https://', 'wss://').replace('http://', 'ws://');
                    this.websocket = new WebSocket(`${wsUrl}/v1/stream/dashboard`);
                    
                    this.websocket.onopen = () => {
                        console.log('WebSocket connected');
                    };
                    
                    this.websocket.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleRealTimeUpdate(data);
                    };
                    
                    this.websocket.onclose = () => {
                        console.log('WebSocket disconnected');
                        setTimeout(() => this.connectWebSocket(), 5000);
                    };
                    
                } catch (error) {
                    console.error('WebSocket connection failed:', error);
                }
            }
            
            handleRealTimeUpdate(data) {
                if (data.type === 'analysis_result') {
                    this.addActivityFeedItem(data.data);
                } else if (data.type === 'alert') {
                    this.showNewAlert(data.data);
                }
            }
            
            addActivityFeedItem(result) {
                const feed = document.getElementById('activity-feed');
                const item = document.createElement('div');
                item.className = `alert-item flex items-center space-x-3 p-3 border-b border-gray-100 last:border-b-0`;
                
                const riskClass = `risk-${result.risk_level.toLowerCase()}`;
                
                item.innerHTML = `
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 rounded-full ${riskClass} flex items-center justify-center">
                            <i class="fas ${
                                result.risk_level === 'low' ? 'fa-check' :
                                result.risk_level === 'medium' ? 'fa-exclamation' :
                                'fa-times'
                            } text-xs"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate">
                            ${result.platform} analysis
                        </p>
                        <p class="text-xs text-gray-500">
                            ${(result.authenticity_score * 100).toFixed(1)}% authentic • ${result.processing_time}ms
                        </p>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${this.formatTime(new Date())}
                    </div>
                `;
                
                feed.insertBefore(item, feed.firstChild);
                
                // Keep only last 20 items
                while (feed.children.length > 20) {
                    feed.removeChild(feed.lastChild);
                }
            }
            
            startRealTimeUpdates() {
                setInterval(() => {
                    this.loadDashboardData();
                }, this.refreshInterval * 1000);
            }
            
            showConfigModal() {
                document.getElementById('api-endpoint').value = this.apiEndpoint;
                document.getElementById('api-key').value = this.apiKey;
                document.getElementById('refresh-interval').value = this.refreshInterval;
                document.getElementById('config-modal').classList.remove('hidden');
                document.getElementById('config-modal').classList.add('flex');
            }
            
            hideConfigModal() {
                document.getElementById('config-modal').classList.add('hidden');
                document.getElementById('config-modal').classList.remove('flex');
            }
            
            saveConfiguration() {
                this.apiEndpoint = document.getElementById('api-endpoint').value;
                this.apiKey = document.getElementById('api-key').value;
                this.refreshInterval = parseInt(document.getElementById('refresh-interval').value);
                
                localStorage.setItem('ca_api_endpoint', this.apiEndpoint);
                localStorage.setItem('ca_api_key', this.apiKey);
                localStorage.setItem('ca_refresh_interval', this.refreshInterval);
                
                this.hideConfigModal();
                this.loadDashboardData();
                this.connectWebSocket();
            }
            
            updateApiStatus(status) {
                const indicator = document.getElementById('api-status');
                const text = document.getElementById('api-status-text');
                
                indicator.className = 'status-indicator ' + (
                    status === 'connected' ? 'status-healthy' :
                    status === 'warning' ? 'status-warning' :
                    'status-critical'
                );
                
                text.textContent = status === 'connected' ? 'API Connected' :
                                 status === 'warning' ? 'API Warning' :
                                 'API Error';
            }
            
            showLoading() {
                // Add loading states to metrics
            }
            
            hideLoading() {
                // Remove loading states
            }
            
            formatTime(date) {
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) return 'just now';
                if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
                if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
                return Math.floor(diff / 86400000) + 'd ago';
            }
        }
        
        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new ContentAuthenticityDashboard();
        });
    </script>
</body>
</html>